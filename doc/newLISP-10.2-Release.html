<!DOCTYPE HTML PUBLIC "4.01 Transitional">
<html>
<title>newLISP  v.10.2 Release Notes </title>
<body>
<h1>newLISP<font size=-2>&#174;</font> v.10.2.1 Release Notes <font color="red" size="-2">rev 2010-03-17</font></h1>

<p>This release introduces mutable objects in the FOOP object system and 
some additions and changes to the API.</p>

<p>Note that the name change from <tt>name</tt> to <tt>term</tt> and the introduction
of the new functions <tt>++</tt>, <tt>--</tt> and <tt>extend</tt> can create 
incompatibilities when running new code under older 10.0 and 10.1 based versions of newLISP
or when running older code under the new 10.2 version. For these cases, the release notes 
show code tips, to make code run on the new and older versions.</p>

<p>Version 10.1.8 to 10.1.12 are versions leading up to version 10.2.0</p>
<p>Version 10.2.1 fixes a severe bug in <tt>setf</tt> and <tt>swap</tt> introduced in v.10.1.12.</tt>

<p>Many thanks to all in the newLISP community who have contributed to this
release with advice, discussion and code.</p>

<h3>Mutable objects in FOOP (Functional Object Oriented Programming)</h3>
<ul>
<li>Previous versions passed the FOOP object as first parameter to a FOOP function. From
now on, the object is accessed via a <tt>self</tt> function:<br>

<blockquote><pre>
(new Class 'Circle)

(context Circle)

(define (move dx dy)    ; object not passed as parameter
    (inc (self 1) dx)   ; but accessed via: self
    (inc (self 2) dy))  ; and mutable

(context MAIN)

(set 'myCircle (Circle 1 2 20))

(:move myCircle 3 4)

myCircle &rarr; (Circle 4 6 20)
</pre></blockquote>

The elimination of the object as the first passed parameter makes old FOOP
code imcompatible with new versions. At the same time code to change objects
is much easier to write in the new version, and execution speed is increased.<br><br>

In old FOOP code only function definitions have to be changed by dropping
the first parameter (the target oject) and renaming all occurrences of it
in the function body to <tt>self</tt>. Function calls to FOOP functions
need not to be changed.</li>

</ul>

<h3>Other changes and additions</h3>
<ul>
<li>New <tt>++</tt> and <tt>--</tt> increment and decrement in integer mode.<br>
<br>To make new code using <tt>++</tt> work with older versions of newLISP,
put the following statement at the beginning of the file:<br>
<pre>
    (when (< (sys-info -2) 10110)
        (constant (global '++) inc)
        (constant (global '-- ) dec))
</pre>
</li><br>

<li>The functions <tt>dec</tt> and <tt>inc</tt> now always work in
floating point mode, regardless of the number of parameters. This could create
problems with code interfacing to C library functions. In case integers
have to be passed <tt>dec</tt> and <tt>inc</tt> should be converted
to <tt>++</tt> and <tt>--</tt>.</li><br>

<li>The function <tt>crit-chi2</tt> took <em>(1.0 - alpha)</em> probabilities
to calculate the critical <em>Chi2</em>. Now <em>alpha</em> should be passed as
probability parameter.</LI><br>

<li>A <tt>nil</tt> parameter in the <tt>delete</tt> functions enables 
much faster namespace deletion without reference checking. This mode should 
only be used when no references external to the namespace exist to symbols 
inside that namespace. This is normally true for hash namespaces and object 
systems which strictly limit direct access to namespace variables. Deleting 
symbols or namespaces whose symbols are referenced externally will crash the 
system.</li><br>

<li><tt>define-macro</tt>'s (fexpr's) are now included in error reporting. Before
they would be reported as part of a <tt>define</tt> function which called it.</li><br>

<li>In <tt>det</tt> and <tt>invert</tt> a new optional parameter controls
how zero pivot elements are handled in the LU decomposition algorithm . 
When the optional Boolean parameter is not specified, the functions return 
<tt>nil</tt> on singular matrices. The optional parameter specifies <tt>0.0</tt>
(zero) or a very small number to continue calculation, as required for some
algorithms dealing with singular matrices.</li><br>

<li>An additional and optional list-index in <tt>now</tt> can pick
an element of the result list.</li><br>

<li>A new <tt>extend</tt> function allows destructive appends to lists
or strings. Usage of <tt>write</tt> or <tt>write-bufer</tt> and <tt>write-line</tt> 
for string extension is discouraged. To make newer code using <tt>extend</tt>
run on older version of newLISP, insert the following statement at the beginning
of the program file:<br>
<pre>
    ; make new code working on older versions of newLISP
    (when (< (sys-info -2) 10110)
        (constant (global 'extend) write-buffer))
</pre>
</li><br>

<li>In the <tt>find</tt> function the regex option can now be specified
as <tt>nil</tt> to do an offset-based search without regular expressions.</li><br>

<li>The <tt>name</tt> function has been deprecated; use <tt>term</tt>
instead to extract the symbol name without the context prefix.
The boolean flag option, which was present in <tt>name</tt>, is not
present in <tt>term</tt>, use <tt>prefix</tt> to extract the prefix
context from a symbol.
The new <tt>term</tt> causes much less name clashes with user variables
than <tt>name</tt> did. To make new code using <tt>term</tt> work with oder 
versions of newLISP, put the following statement at the beginning of the file:<br>
<pre>
    ; make new code working on older versions of newLISP
    (when (< (sys-info -2) 10111)
        (constant (global 'term) name)) 
</pre>
</li><br>

<li>A new <tt>prefix</tt> function returns the context of a symbol passed
as parameter.</li><br>

<li>The <tt>pretty-print</tt> function can take an additional 
parameter to specify the default format string for printing floating point 
numbers. This is useful when printing unformatted floating point numbers without 
fractional parts, and these numbers should still be recognizabe as floating point 
numbers.</li><br>

<li>The deprecated use of <tt>$0</tt> in <tt>ref, ref-all, set-ref</tt>
and <tt>set-ref-all</tt> has been removed. In <tt>set-ref</tt> and <tt>set-ref-all</tt>,
use only the anaphoric system variable <tt>$it</tt> to refer to the old contents.
<tt>ref</tt> and <tt>ref-all</tt> can take a <tt>true</tt> option to return
actual elements (formerly returned in <tt>$0</tt>) instead of index vectors.
The usage of the system variables <tt>$0</tt> through <tt>$9</tt> is 
reserved for the case where regular expression matching is involved (with
few exceptions).</li><br>

<li><tt>read</tt> and <tt>write</tt> may be used as shorter writings of the
elementary I/O functions <tt>read-buffer</tt> and <tt>write-buffer</tt>.</li><br>

<li>In <tt>starts-with</tt> and <tt>ends-with</tt> <tt>nil</tt> is not allowed
anymore as option for case insensivity. Use the regex option <tt>1</tt> instead:</li><br>

<pre>
    ; instead of 
    (starts-with foo bar nil)
    ; do
    (starts-with foo bar 1)
</pre>

<p>This change will be compatible with previous versions of newLISP. But
older code will throw an error exception if specifying <tt>nil</tt> instead
of option <tt>1</tt> for case insensitivity.</p>
</li>

<li>The enviroment variable REQUEST_METHOD is now set by newLISP server mode
to one of the strings GET, HEAD, PUT, POST, DELETE</li>

</ul>

<h3>Changes and additions in external files</h3>
<ul>
<li>Version 2.0 of GMP module file <tt>gmp.lsp</tt> fixes problems when using 
64-bit newLISP.
</li><br>

<li>The SMTP module file <tt>smtpx.lsp</tt> has been replaced with a new
version 3.0 by Greg Slepak from http://taoeffect.com. The new version allows 
for a custom port and does UTF-8 safe encoding.</li><br>

<li>Cygwin is now supported again with <tt>makefile_cygwin</tt> and also
recognized by the <tt>configure</tt> utility. The <tt>makefile_cygwin</tt>
produces a <tt>newlisp.exe</tt> which can be placed into <tt>%NEWLISPDIR%</tt>
together with <tt>cygwin1.dll</tt> from the 
<a href="http://www.cygwin.com/">Cygwin</a> system.
The environment variable <tt>NEWLISPDIR</tt> is set after after installing
the Win32 version of newLISP and in most cases points to <tt>C:\Program files\newlisp</tt>
 or the equivalent in other language locales than English. The functions 
<tt>fork</tt>, <tt>spawn</tt>, <tt>sync</tt>, <tt>send</tt> and <tt>receive</tt>, 
which do not work in the normal Win32 version, work on Cygwin compiled newLISP, 
although slow.<br>
<p>Many thanks to Niek Albers from http://daansystems.com, for doing most of the work
of making complilation work on Cygwin again.</p></li>

<li>The <tt>doc/INSTALL</tt> text file has an additional chapter for 
customized install and for package creators.</li><br>

<li>The editor syntax highlighting files in the <tt>util</tt> subdirectory of the
source distribution have been updated:<br>
<pre>
    nanorc, newlisp.jsf, newlisp.vim
</pre>
</li><br>

<li>The following standard module files needed to be updated to run on both
10.1 and 10.2 versions of newLISP:<br>
<pre>
    canvas.lsp, ftp.lsp, gimp.lsp, postgres.lsp, sqlite3.lsp, stat.lsp, zlib.lsp
</pre>
</li><br>

<li>The following utilities shipped with the source distribution and
published on http://newlisp.org have been updated to run on both
10.1 and 10.2 versions of newLISP:<br>
<pre>
    newlispdoc, syntax.cgi, upload.cgi, xmlrpc.cgi
</pre>
</li>
</ul>

<h3>Bug fixes</h3>
<ul>
<li>The <em>Chi2</em> values calculated by <tt>crit-chi2</tt> were too low for 
odd numbers of <em>degrees of freedom</em> &ndash; the <tt>bayes-query</tt> function
was <u>not</u> affected by this.</li><br>

<li>FOOP objects were not protected if held by a protected symbol.</li><br>

<li><tt>get-int</tt> did not do proper sign-extension in the 64-bit version
of newLISP.</li><br>

<li><tt>get-url</tt> now also handles error code 302 for re-location using the 
<tt>location:</tt> header. In the past only codes 301 and 303 were handled for
automatic re-requesting with changed URI.</li><br>

<li><tt>new</tt> had a memory leak in certain applications of this function.</li><br>

<li>The <tt>nil?</tt> predicate evaluated twice.</li><br>

<li>The probabilities calculated by <tt>prob-chi2</tt> were too low for
odd numbers of <em>degrees of freedom</em>.</li><br>

<li><tt>push</tt> on <tt>-1</tt> (end of list) optimization was broken when copying 
namespaces with <tt>new</tt>.</li><br>

<li>When using <tt>push</tt> on uninitialized symbols, the element
pushed was returned instead of the new list created.</li><br> 

<li>The <tt>select</tt> function now throws an error message when overrunning
indexes.</li><br>

<li><tt>self</tt> now honours symbol protection, if the object passed is
held by a protected symbol.</li><br>

<li>A fix for string stream writing in 64-bit newLISP.</li><br>

<li>A messagebox pops up if a connection cannot be established between the
newLISP process and the Java GUI server on Win32.</li><br>

<li><tt>xml-parse</tt> now parses correctly UTF-8 characters.</li>

</ul>

<center>&part;</center>

</body>
</html>
